# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

pr: none

jobs:
- job: BuildApp
  displayName: Build App
  pool:
    vmImage: 'Ubuntu 16.04'
  steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '10.12.x'
  - script: |
      yarn
      yarn tools:prepare-lib
      yarn ng build alyle-ui --aot --output-path dist/alyle-ui-aot
      yarn build
  - task: PublishBuildArtifacts@1
    inputs:
      pathtoPublish: 'dist/alyle-ui'
      artifactName: Alyle UI App
  - task: PublishBuildArtifacts@1
    inputs:
      pathtoPublish: 'ci/scripts'
      artifactName: Scripts

- job: Test
  displayName: Test
  pool:
    vmImage: 'Ubuntu 16.04'
  steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '10.12.x'
  - bash: |
      yarn
      ./ci/scripts/test.sh

- job: BuildDocsAndArtifacts
  displayName: Build docs & artifacts
  pool:
    vmImage: 'Ubuntu 16.04'
  steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '10.12.x'
  - bash: |
      ./ci/scripts/build-docs-artifacts.sh
    displayName: build:@alyle/ui
  - script: |
      yarn tools:docs
    displayName: Build docs-content
  - task: PublishBuildArtifacts@1
    inputs:
      pathtoPublish: 'dist/docs-content'
      artifactName: Docs
  - task: PublishBuildArtifacts@1
    inputs:
      pathtoPublish: 'dist/@alyle/ui'
      artifactName: alyle-ui-pkg